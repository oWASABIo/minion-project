import{d as e,r as t,l as r,u as s,a as o,k as a}from"../../nitro/nitro.mjs";import{g as i,a as n}from"../../_/gemini.mjs";const c=[{id:"saas-b2b",label:"B2B Enterprise SaaS",template:"saas",description:"Trust-focused layout for enterprise software.",pages:[{id:"home",route:"/",structure:["hero","stats","features","testimonials","pricing","faq","cta"],promptFocus:"Enterprise B2B SaaS for {brief}. Focus on security, scale, and ROI. Use authoritative tone."},{id:"pricing",route:"/pricing",structure:["hero","pricing","faq","cta"],promptFocus:"Detailed pricing tiers for {brief}. FAQ about enterprise licenses."},{id:"contact",route:"/contact",structure:["hero","team","cta"],promptFocus:"Contact sales for {brief}. Offices and support."}]},{id:"saas-ai",label:"AI Startup Launch",template:"saas",description:"Futuristic, dark-mode ready layout for AI tools.",pages:[{id:"home",route:"/",structure:["hero","features","stats","cta"],promptFocus:"AI tool launch for {brief}. Focus on 'Magic' and speed. Futuristic tone."},{id:"features",route:"/features",structure:["hero","features","cta"],promptFocus:"Deep dive into AI capabilities of {brief}."}]},{id:"landing-saas-v1",label:"SaaS Product Launch",template:"landing",pages:[{id:"home",route:"/",structure:["hero","features","testimonials","pricing","cta"],promptFocus:"High converting SaaS landing page for {brief}. Focus on benefits and trust."},{id:"about",route:"/about",structure:["hero","team","stats","cta"],promptFocus:"About the company building {brief}. Mission driven and professional."},{id:"contact",route:"/contact",structure:["hero","faq","cta"],promptFocus:"Contact support for {brief}. FAQ included."}]},{id:"landing-mobile-app",label:"Mobile App Showcase",template:"landing",pages:[{id:"home",route:"/",structure:["hero","features","stats","cta"],promptFocus:"Mobile app showcase for {brief}. Focus on screenshots and download links."},{id:"features",route:"/features",structure:["hero","features","cta"],promptFocus:"Detailed features of the app {brief}."}]},{id:"company-corporate",label:"Modern Corporate",template:"company",pages:[{id:"home",route:"/",structure:["hero","features","stats","cta"],promptFocus:"Corporate website for {brief}. Trustworthy and established."},{id:"about",route:"/about",structure:["hero","team","testimonials","cta"],promptFocus:"History and leadership of {brief}."},{id:"services",route:"/services",structure:["hero","features","pricing","cta"],promptFocus:"Professional services offered by {brief}."},{id:"contact",route:"/contact",structure:["hero","faq","cta"],promptFocus:"Get in touch with {brief}."}]},{id:"blog-personal",label:"Personal Brand",template:"blog",pages:[{id:"home",route:"/",structure:["hero","blogList","cta"],promptFocus:"Personal blog of an expert in {brief}."},{id:"about",route:"/about",structure:["hero","stats","cta"],promptFocus:"About the author of {brief}."}]},{id:"ecommerce-store",label:"Brand Store",template:"ecommerce",pages:[{id:"home",route:"/",structure:["hero","features","productList","testimonials"],promptFocus:"Storefront for {brief}. Highlight best sellers."},{id:"shop",route:"/shop",structure:["hero","productList"],promptFocus:"Full product catalog for {brief}. Organized grid."},{id:"product-detail",route:"/product/:id",structure:["productDetail","productList"],promptFocus:"Single product view. Focus on details and conversion. RELATED SECTION is mandatory."},{id:"about",route:"/about",structure:["hero","stats","team"],promptFocus:"Our story and craftsmanship for {brief}."},{id:"contact",route:"/contact",structure:["hero","faq"],promptFocus:"Customer support for {brief}."}]},{id:"portfolio-creative",label:"Creative Portfolio",template:"portfolio",description:"Visual-heavy layout for creatives and agencies.",pages:[{id:"home",route:"/",structure:["hero","features","testimonials","cta"],promptFocus:"Creative portfolio for {brief}. Focus on visual impact and past work. Use features section to showcase projects grid."},{id:"projects",route:"/projects",structure:["hero","features"],promptFocus:"Full list of projects by {brief}."},{id:"about",route:"/about",structure:["hero","team","stats","cta"],promptFocus:"Our creative philosophy and the team behind {brief}."},{id:"contact",route:"/contact",structure:["hero","faq","cta"],promptFocus:"Work with us. Contact {brief}."}]},{id:"portfolio-minimal",label:"Minimalist Folio",template:"portfolio",description:"Clean, text-forward portfolio for writers or strategists.",pages:[{id:"home",route:"/",structure:["hero","blogList","cta"],promptFocus:"Minimalist portfolio for {brief}. Focus on typography and case studies (blog list)."},{id:"about",route:"/about",structure:["hero","stats"],promptFocus:"Bio and achievements of {brief}."}]},{id:"company-service",label:"Local Service Business",template:"company",description:"Perfect for local businesses and service providers.",pages:[{id:"home",route:"/",structure:["hero","features","stats","testimonials","faq","cta"],promptFocus:"Local service business website for {brief}. Trust and reliability."},{id:"services",route:"/services",structure:["hero","features","pricing","cta"],promptFocus:"Services and packages offered by {brief}."},{id:"contact",route:"/contact",structure:["hero","team","cta"],promptFocus:"Get a quote from {brief}."}]}];function getRandomTemplate(e,t){const r=c.filter(t=>t.template===e);if(0===r.length)return c[0];return r[Math.abs(t)%r.length]}const l=new Set(["hero","features","testimonials","faq","blogList","cta","pricing","stats","team"]),u={nuxt:{label:"Nuxt 3 Starter",description:"Modern Vue 3 + Nuxt 4 stack with TailwindCSS.",allowedSections:l,defaultOrder:e=>"company"===e?["hero","features","testimonials","cta"]:"blog"===e?["hero","blogList","cta"]:["hero","features","testimonials","faq","cta"],constraints:{hero:{allowedVariants:["center","split","left","right"],defaultVariant:"center"}}},"vue-vite":{label:"Vue 3 + Vite",description:"Pure Vue 3 with Vite for maximum speed.",allowedSections:l,defaultOrder:e=>"company"===e?["hero","features","testimonials","cta"]:["hero","features","testimonials","faq","cta"],constraints:{hero:{allowedVariants:["center","split","left","right"],defaultVariant:"center"}}},nextjs:{label:"Next.js Starter",description:"A robust React framework starter.",allowedSections:l,defaultOrder:e=>"landing"===e?["hero","features","testimonials","cta"]:["hero","features","faq","cta"],constraints:{hero:{allowedVariants:["split","center"],defaultVariant:"split"}}},"wordpress-theme":{label:"WordPress Theme (Headless)",description:"Headless setup using WordPress as CMS.",allowedSections:l,defaultOrder:e=>["hero","features","blogList","testimonials","cta"],constraints:{hero:{allowedVariants:["center","left"],defaultVariant:"center"},blogList:{forceSourcetemplate:"wordpress"}}}};function getStackSpec(e="nuxt"){return u[e]||u.nuxt}const d={landing:{label:"Landing Page",description:"High conversion page for products or services.",defaultSectionOrder:["hero","features","pricing","testimonials","faq","cta"],requiredSections:["hero","cta"],promptFocus:"Focus on conversion, clear value proposition, and call to action. Use persuasive copy."},company:{label:"Company Site",description:"Corporate or agency website focusing on trust and brand.",defaultSectionOrder:["hero","features","stats","team","testimonials","cta"],requiredSections:["hero"],promptFocus:"Focus on trust, professional tone, company values, and services offered. Use 'About Us' style content."},blog:{label:"Blog / News",description:"Content-focused site with article listings.",defaultSectionOrder:["hero","blogList","cta"],requiredSections:["blogList"],promptFocus:"Focus on content discovery. The hero should highlight the latest news or main category. Ensure the blog list is prominent."},ecommerce:{label:"E-Commerce",description:"Online store front for selling products.",defaultSectionOrder:["hero","features","productList","testimonials"],requiredSections:["hero","productList"],promptFocus:"Focus on product showcasing. Use 'features' section to highlight categories. Ensure 'productList' shows top selling items."},portfolio:{label:"Portfolio",description:"Showcase work and case studies for creatives.",defaultSectionOrder:["hero","features","testimonials","cta"],requiredSections:["hero","features"],promptFocus:"Focus on visual impact, showcasing projects (use features section for this), and clear contact info."},saas:{label:"SaaS / Startup",description:"High-growth B2B or B2C software product sites.",defaultSectionOrder:["hero","stats","features","testimonials","pricing","faq","cta"],requiredSections:["hero","pricing","cta"],promptFocus:"Focus on problem-solution fit, ROI metrics (stats), main features, and clear tiered pricing."}};function gettemplateSpec(e){return d[e]||d.landing}function hashString(e){let t=2166136261;for(let r=0;r<e.length;r++)t^=e.charCodeAt(r),t=Math.imul(t,16777619);return t>>>0}function pick(e,t){return e[Math.abs(t)%e.length]}function makeAccent(e,t,r,s){return pick(["#4f46e5","#06b6d4","#22c55e","#f97316","#ec4899","#a855f7","#eab308","#ef4444","#14b8a6","#3b82f6","#8b5cf6","#d946ef","#f43f5e","#84cc16","#0ea5e9"],hashString(`${e}|${s}|${t}|${r}`))}function titleFromBrief(e,t){const r=(e||"").trim();return r?r.split("\n")[0].slice(0,48):t}function buildMockProject(e){const{template:t,brief:r,stack:s,seed:o}=e,a=getRandomTemplate(t,o),i=o%2==0?"dark":"light",n={};for(const s of a.pages){const a=`${r}. ${s.promptFocus}`,c=o+hashString(s.id);n[s.id]=buildMockPageConfig({...e,template:t,brief:a,seed:c,structure:s.structure,themeMode:i})}return{template:a.template,templateId:a.id,site:{siteName:titleFromBrief(r,"Generated Site"),tagline:"Generated by MINIONS",primaryColor:makeAccent(t,o,r,s),themeMode:i},backend:{cms:"wordpress",wordpress:e.wordpressBaseUrl?{baseUrl:e.wordpressBaseUrl,restBase:e.wordpressRestBase}:{baseUrl:"",restBase:e.wordpressRestBase}},pages:n,meta:{mode:"mock",generatedAt:(new Date).toISOString(),seed:o,stack:s}}}function buildMockPageConfig(e){const{template:t,brief:r,stack:s,seed:o}=e,a=hashString(`${t}|${s}|${o}|${r}`),i=getStackSpec(s),n=gettemplateSpec(t);e.themeMode;let c=[];if(e.structure)c=[...e.structure];else{const e=n.defaultSectionOrder,t="hero"===e[0],r="cta"===e[e.length-1];let s=e.slice(t?1:0,r?e.length-1:e.length);s=function(e,t){const r=[...e];let s,o,a=r.length,i=t%2147483647;i<=0&&(i+=2147483646);const next=()=>(i=16807*i%2147483647,(i-1)/2147483646);for(;a;)o=Math.floor(next()*a--),s=r[a],r[a]=r[o],r[o]=s;return r}(s,a),c=[...t?["hero"]:[],...s,...r?["cta"]:[]]}const l=(e.wordpressBaseUrl||"").trim()||"",u=(e.wordpressRestBase||"").trim()||"/wp-json/wp/v2",d=titleFromBrief(r,"Generated Preview"),p=makeAccent(t,o,r,s),m=c.map((e,t)=>{const r={h:a+13*t,stackSpec:i,stack:s,seed:o,siteName:d,wpBaseUrl:l};switch(e){case"hero":return function(e){var t;const r=(null==(t=e.stackSpec.constraints.hero)?void 0:t.allowedVariants)||["center"],s=pick(r,e.h);return{id:"hero-main",type:"hero",variant:s,eyebrow:`${e.stackSpec.label} Concept`.toUpperCase(),headline:"split"===s?`Your Idea: ${e.siteName}`:`Build ${e.siteName} with ${e.stackSpec.label}`,subheadline:"This is a mock generated based on your brief, seed, and selected stack constraints.",primaryCta:{label:"Generate (Live)",href:"#get-started"},secondaryCta:{label:"Learn More",href:"#examples"}}}(r);case"features":return function(e){return{id:"features-main",type:"features",title:pick(["Key Features","Why Us?","Highlights","Core Benefits"],e.h),subtitle:`Optimized for ${e.stackSpec.label} architecture.`,items:[{title:"Stack Optimized",description:`Generated specifically for ${e.stack} conventions.`},{title:"Deterministic Mock",description:`Same seed (${e.seed}) = Same result.`},{title:"Customizable",description:"Edit brief to change the tone/content keywords."}]}}(r);case"testimonials":return function(e){return{id:"testimonials-main",type:"testimonials",title:"Testimonials",items:[{quote:`The ${e.stack} output structure is exactly what I needed.`,name:"Alex",role:"Developer"},{quote:"Mock generation is super fast and consistent.",name:"Sarah",role:"Product Manager"}]}}(r);case"faq":return{id:"faq-main",type:"faq",title:"Frequently Asked Questions",items:[{q:"How does the stack selection affect output?",a:"It changes section ordering, constraints, and constraints valid for that framework."},{q:"Can I export this?",a:"Yes, you can export the JSON config using the Export panel."}]};case"blogList":return function(e){var t;return{id:"blog-latest",type:"blogList",title:e.wpBaseUrl?"From the Blog":"Blog (Configure WP)",subtitle:e.wpBaseUrl||"wordpress"===(null==(t=e.stackSpec.constraints.blogList)?void 0:t.forceSourcetemplate)?"Fetching from WordPress API":"Connect your CMS to see real posts",maxItems:3,source:{template:"wordpress",endpoint:"/posts?per_page=3&_embed"}}}(r);case"pricing":return{id:"pricing-main",type:"pricing",title:"Simple, Transparent Pricing",subtitle:"Choose the plan that's right for you.",plans:[{name:"Starter",price:"$0",period:"/mo",description:"Perfect for hobbyists.",features:["1 Project","Community Support","Basic Analytics"],cta:{label:"Start Free",href:"#free"}},{name:"Pro",price:"$29",period:"/mo",isPopular:!0,description:"For serious developers.",features:["Unlimited Projects","Priority Support","Advanced Analytics","Custom Domain"],cta:{label:"Get Pro",href:"#pro"}},{name:"Enterprise",price:"$99",period:"/mo",description:"For large teams.",features:["SSO Integration","Dedicated Success Manager","SLA","Audit Logs"],cta:{label:"Contact Sales",href:"#contact"}}]};case"stats":return{id:"stats-main",type:"stats",title:"Trusted by Developers",variant:"card",items:[{value:"10k+",label:"Active Users",description:"Growing daily"},{value:"99.9%",label:"Uptime",description:"Enterprise grade reliability"},{value:"24/7",label:"Support",description:"We are always here"},{value:"500+",label:"Components",description:"Ready to use"}]};case"team":return{id:"team-main",type:"team",title:"Meet the Team",subtitle:"The experts behind the magic.",members:[{name:"Sarah Chen",role:"CEO & Founder",bio:"Visionary leader with 10+ years in Tech.",avatar:"/images/team-1.png"},{name:"David Miller",role:"CTO",bio:"Full stack wizard and open source contributor.",avatar:"/images/team-2.png"},{name:"Emily Davis",role:"Head of Design",bio:"Creating beautiful pixels and user experiences.",avatar:"/images/team-3.png"},{name:"Michael Wilson",role:"Lead Engineer",bio:"Architecting scalable systems.",avatar:"/images/team-4.png"}]};case"cta":default:return mockCta(r);case"productList":return{id:"products-grid",type:"productList",title:"Featured Collection",subtitle:"Handpicked items just for you.",maxItems:6,displayMode:"grid"};case"productDetail":return function(e){return{id:"product-main",type:"productDetail",showRelated:!0,showReviews:!0,mockProduct:{name:"Premium Mock Object",price:"$129.00",description:"This is a placeholder product generated by the mock system.",sku:"MOCK-001",images:[`https://picsum.photos/seed/${e.seed}/600/600`,`https://picsum.photos/seed/${e.seed+1}/600/600`]}}}(r)}});return{template:t,site:{siteName:d,tagline:"Generated by MINIONS",primaryColor:p},backend:{cms:"wordpress",wordpress:l?{baseUrl:l,restBase:u}:{baseUrl:"",restBase:u}},sections:m,meta:{mode:"mock",generatedAt:(new Date).toISOString(),seed:o,stack:s,note:"Mock generator via Stack Spec."}}}function mockCta(e){return{id:"cta-bottom",type:"cta",title:"Ready to launch?",headline:"Start building today",subheadline:`Get your ${e.stackSpec.label} starter kit now.`,primaryCta:{label:"Get Started",href:"#get-started"}}}const p=new Set(["site","style","content","wordpress","config"]);function setNested(e,t,r,s){const o=s.trim();if(o){if("site"===t)return e.site||(e.site={}),"siteName"===r&&(e.site.siteName=o),"tagline"===r&&(e.site.tagline=o),void("primaryColor"===r&&(e.site.primaryColor=o));if("style"===t)return e.style||(e.style={}),"tone"===r&&(e.style.tone=o),"language"===r&&(e.style.language=o),void("keywords"===r&&(e.style.keywords=o));if("wordpress"===t)return e.wordpress||(e.wordpress={}),"baseUrl"===r&&(e.wordpress.baseUrl=o),"restBase"===r&&(e.wordpress.restBase=o),void("postsEndpoint"===r&&(e.wordpress.postsEndpoint=o));if("config"!==t)"content"===t&&(e.content||(e.content={}),e.content[r]=o);else if(e.config||(e.config={}),"seed"===r){const t=parseInt(o,10);isNaN(t)||(e.config.seed=t)}}}const toStr=e=>"string"==typeof e?e:null==e?"":String(e);function normalizePageConfig(e,t){var r,s,o,a;const i=e&&"object"==typeof e?{...e}:{};i.template=toStr(i.template)||t.template,i.stack=toStr(i.stack)||t.stack;const n={siteName:toStr(i.siteName)||"",tagline:toStr(i.tagline)||"",primaryColor:toStr(i.primaryColor)||""};i.site=i.site&&"object"==typeof i.site?{...i.site}:{},i.site.siteName=toStr(i.site.siteName)||n.siteName||"Generated Preview",i.site.tagline=toStr(i.site.tagline)||n.tagline||"",i.site.primaryColor=toStr(i.site.primaryColor)||n.primaryColor||"#4f46e5";const c=(t.wordpressBaseUrl||(null==(s=null==(r=i.backend)?void 0:r.wordpress)?void 0:s.baseUrl)||"").trim(),l=(t.wordpressRestBase||(null==(a=null==(o=i.backend)?void 0:o.wordpress)?void 0:a.restBase)||"/wp-json/wp/v2").trim();c&&(i.backend=i.backend&&"object"==typeof i.backend?{...i.backend}:{},i.backend.cms="wordpress",i.backend.wordpress={baseUrl:c,restBase:l});const u=Array.isArray(i.sections)?i.sections:[];return i.sections=u.map((e,r)=>{var s;const o=e&&"object"==typeof e?e:{};let a={...o,...o.content&&"object"==typeof o.content?o.content:{}};delete a.content;let n=toStr(a.type)||"hero";if(n=n.charAt(0).toLowerCase()+n.slice(1),"bloglist"===n&&(n="blogList"),"productlist"===n&&(n="productList"),"productdetail"===n&&(n="productDetail"),a.type=n,a.id=toStr(a.id)||`${a.type}-${r+1}`,"hero"===a.type&&(a.tag&&!a.eyebrow&&(a.eyebrow=a.tag),a.title&&!a.headline&&(a.headline=a.title),a.headline||(a.headline="Generated Hero"),a.description&&!a.subheadline&&(a.subheadline=a.description),a.subtitle&&!a.subheadline&&(a.subheadline=a.subtitle),Array.isArray(a.actions)&&(a.actions.length>0&&!a.primaryCta&&(a.primaryCta={label:a.actions[0].label||a.actions[0].text||"Get Started",href:a.actions[0].link||a.actions[0].href||"#"}),a.actions.length>1&&!a.secondaryCta&&(a.secondaryCta={label:a.actions[1].label||a.actions[1].text||"Learn More",href:a.actions[1].link||a.actions[1].href||"#"})),a.image||(a.image=`https://picsum.photos/seed/${t.seed+r}/800/600`)),"features"===a.type&&(a.title=toStr(a.title)||"Features",a.description&&!a.subtitle&&(a.subtitle=a.description),null!=a.subtitle&&(a.subtitle=toStr(a.subtitle)),a.items=Array.isArray(a.items)?a.items.map(e=>({title:toStr(null==e?void 0:e.title)||"Feature",description:toStr(null==e?void 0:e.description)||""})):[]),"testimonials"===a.type&&(a.title=toStr(a.title)||"Testimonials",a.items=Array.isArray(a.items)?a.items.map(e=>({quote:toStr(null==e?void 0:e.quote)||"",name:toStr(null==e?void 0:e.name)||"",role:toStr(null==e?void 0:e.role)||void 0,avatar:(null==e?void 0:e.avatar)||`https://api.dicebear.com/7.x/avataaars/svg?seed=${toStr(null==e?void 0:e.name)}`})):[]),"team"===a.type){a.title=toStr(a.title)||"Our Team",null!=a.subtitle&&(a.subtitle=toStr(a.subtitle));const e=Array.isArray(a.members)?a.members:Array.isArray(a.items)?a.items:[];a.items=e.map((e,s)=>({name:toStr(null==e?void 0:e.name)||"Member Name",role:toStr(null==e?void 0:e.role)||"Role",bio:toStr(null==e?void 0:e.bio),avatar:toStr(null==e?void 0:e.avatar)||`https://api.dicebear.com/7.x/avataaars/svg?seed=${toStr(null==e?void 0:e.name)||t.seed+r+s}`,socials:(null==e?void 0:e.socials)||{}}))}if("faq"===a.type&&(a.title=toStr(a.title)||"FAQ",Array.isArray(a.items)?a.items=a.items.map(e=>({q:toStr(null==e?void 0:e.q)||toStr(null==e?void 0:e.question)||"",a:toStr(null==e?void 0:e.a)||toStr(null==e?void 0:e.answer)||""})):a.items=[]),"cta"===a.type){a.headline=toStr(a.headline)||toStr(a.title)||"Call to action";const e=toStr(a.description),t=toStr(a.subheadline)||toStr(a.subtitle);a.subheadline=t||e||"",a.description=e||a.subheadline||"",a.primaryCta&&"object"==typeof a.primaryCta?a.primaryCta={label:toStr(a.primaryCta.label)||"Get started",href:toStr(a.primaryCta.href)||"#get-started"}:a.primaryCta={label:"Get started",href:"#get-started"},a.secondaryCta&&"object"==typeof a.secondaryCta&&(a.secondaryCta={label:toStr(a.secondaryCta.label)||"Learn more",href:toStr(a.secondaryCta.href)||"#"})}if("blogList"===a.type){const e=toStr(a.postsEndpoint)||toStr(null==(s=a.source)?void 0:s.endpoint);a.source=a.source&&"object"==typeof a.source?{...a.source}:{template:"wordpress",endpoint:""},a.source.template=toStr(a.source.template)||"wordpress",a.source.endpoint=e||"/posts?per_page=3&_embed",a.title=toStr(a.title)||"Latest from WordPress",null!=a.subtitle&&(a.subtitle=toStr(a.subtitle)),null!=a.layout&&(a.layout=toStr(a.layout)),"number"!=typeof a.maxItems&&(a.maxItems=3)}return"productList"===a.type&&(a.title=toStr(a.title)||"Featured Products",a.subtitle=toStr(a.subtitle)||"Explore our latest collection","number"!=typeof a.maxItems&&(a.maxItems=6),a.displayMode=toStr(a.displayMode)||"grid"),"productDetail"===a.type&&(null==a.showRelated&&(a.showRelated=!0),null==a.showReviews&&(a.showReviews=!0)),function(e,t){const r=getStackSpec(t),s=e.type;if(r.allowedSections.has(s),"hero"===s&&r.constraints.hero){const t=e;r.constraints.hero.allowedVariants.includes(t.variant)||(t.variant=r.constraints.hero.defaultVariant)}if("blogList"===s&&r.constraints.blogList){const t=e;r.constraints.blogList.forceSourcetemplate&&(t.source||(t.source={}),t.source.template=r.constraints.blogList.forceSourcetemplate)}return e}(a,i.stack)}),i.meta=i.meta&&"object"==typeof i.meta?{...i.meta}:{},i.meta.mode=t.mode,i.meta.seed=t.seed,i.meta.stack=toStr(i.meta.stack)||i.stack||t.stack,i}function validatePageConfig(e){const t=[];return e&&"object"==typeof e?(e.template||t.push("Missing root field 'template'"),e.site||t.push("Missing root field 'site'"),e.pages?"object"!=typeof e.pages?t.push("Field 'pages' must be an object"):Object.keys(e.pages).forEach(r=>{const s=e.pages[r];s.sections&&Array.isArray(s.sections)?s.sections.forEach((e,s)=>{validateSection(e,s,t,r)}):t.push(`Page [${r}] missing 'sections' array`)}):Array.isArray(e.sections)?e.sections.forEach((e,r)=>{validateSection(e,r,t)}):e.content&&Array.isArray(e.content)?t.push("Found 'content' array but expected 'sections'. Please rename 'content' to 'sections'."):t.push("Missing or invalid 'sections' array (or 'pages' object)"),{valid:0===t.length,errors:t}):{valid:!1,errors:["Root config must be an object"]}}function validateSection(e,t,r,s){const o=s?`Page [${s}] Section [${t}]`:`Section [${t}]`,a=["hero","features","testimonials","faq","blogList","cta","pricing","stats","team"];if(!e.type)return void r.push(`${o} missing 'type'`);const i=e.type.charAt(0).toLowerCase()+e.type.slice(1);switch(a.includes(i)||a.includes(e.type)||r.push(`${o} has unknown type '${e.type}'. Allowed: ${a.join(", ")}`),e.id||r.push(`${o} (${e.type}) missing 'id'`),e.type){case"hero":e.headline||r.push(`${o} (hero) missing 'headline'`);break;case"features":Array.isArray(e.items)||r.push(`${o} (features) missing 'items' array`);break;case"testimonials":Array.isArray(e.items)||r.push(`${o} (testimonials) missing 'items' array`);break;case"pricing":Array.isArray(e.plans)||r.push(`${o} (pricing) missing 'plans' array`);break;case"stats":Array.isArray(e.items)||r.push(`${o} (stats) missing 'items' array`)}return{valid:0===r.length,errors:r}}function extractJson(e){const t=function(e){let t=e.trim();if(t.startsWith("```")){const e=t.split("\n");e[0].startsWith("```")&&e.shift(),e[e.length-1].startsWith("```")&&e.pop(),t=e.join("\n")}return t}(e);try{return JSON.parse(t)}catch{const e=t.match(/\{[\s\S]*\}/);if(!e)throw new Error("Model did not return JSON.");return JSON.parse(e[0])}}const m=e(async e=>{var c,l,u,d,m,f,h,g,b;try{const y=await t(e),v=(y.template||"landing").toString(),w=(y.brief||"").toString().trim(),S=y.mode||"auto",k=(y.stack||"nuxt").toString()||"nuxt",C=(y.wordpressBaseUrl||"").toString().trim(),F=(y.wordpressRestBase||"").toString().trim();let A="number"==typeof y.seed?y.seed:void 0;if(!w)throw r({statusCode:400,statusMessage:"Brief is required"});const{cleanBrief:$,directives:M}=function(e){const t=(e||"").replace(/\r\n/g,"\n").split("\n"),r={},s=[];let o=null;for(const e of t){let t=e.split("//")[0].trim();if(!t)continue;const a=t.match(/^\[([a-zA-Z0-9_-]+)\]$/);if(a){const e=a[1].toLowerCase();o=p.has(e)?e:null;continue}if(o){const e=t.indexOf(":");if(-1===e)continue;setNested(r,o,t.slice(0,e).trim(),t.slice(e+1).trim());continue}s.push(t)}return{cleanBrief:s.join("\n").trim(),directives:r}}(w);void 0===A&&"number"==typeof(null==(c=M.config)?void 0:c.seed)&&(A=M.config.seed),void 0===A&&(A=Date.now());const N=s(),P=(N.geminiApiKey||o.env.GEMINI_API_KEY||"").length>0,B="live"===S||"auto"===S;let O=null,L="mock",j="";try{if(y.stream&&B&&P){const t=gettemplateSpec(v),{systemPrompt:r}=await import("../../_/prompts.mjs"),s=["System:",r(t,k),"---","User Context:",`Brief: ${w}`,`Directives: ${JSON.stringify(M||{})}`,$?`Clean Intent: ${$}`:""].join("\n");return a(e,new ReadableStream({async start(e){try{const t=await i(s);for await(const r of t.stream){const t=r.text();e.enqueue((new TextEncoder).encode(t))}e.close()}catch(t){console.error("[Streaming] Error:",t);try{e.enqueue((new TextEncoder).encode(`\n\n[ERROR]: ${t.message}`))}catch{}e.close()}}}))}if("mock"===S||!P&&B)L="mock",j=!P&&B?"Falling back to Mock Mode (No valid API Key found).":"Mock Mode requested.",O=buildMockProject({template:v,brief:$||w,stack:k,seed:A,wordpressBaseUrl:C,wordpressRestBase:F});else if(B&&P)try{L="live";const e=getRandomTemplate(v,A),t=e.id,r=["Role: specialized UI Composer (The Smart Chef).","Task: Composition only. Select and arrange sections to build a high-conversion landing page.",`Available Ingredients (Vocabulary): [${["hero","features","testimonials","faq","blogList","cta","pricing","stats","team"].join(", ")}]`,`- Stack: ${k}. Adjust content/structure conventions accordingly.`,"CRITICAL RULES:","1. NO NEW INGREDIENTS: You must ONLY use the section types listed above. Do not invent 'map', 'contact', 'about', etc.","2. ADAPTIVE RECIPE: The provided structure is a recommendation. You MAY add, remove, or reorder sections if it better fits the specific User Brief.","3. FLATTEN: Output a flat 'sections' array. Do not nest content.","4. OUTPUT: strictly JSON matching PageConfig schema."].join("\n"),generatePageWithRepair=async(e,t,s,o)=>{const a=gettemplateSpec(v),i=o?`Recommended Structure: [${o.join(", ")}]. \nGuidance: Use this as a starting point. If the brief asks for something specific (e.g. "focus on trust"), add 'testimonials' or 'stats' even if not in the recommendation.`:"Recommendation: Create a logical conversion flow.";let c=["System:",[r,`Page Context: ${e} (${a.promptFocus})`,i,s.siteName?`- Site Name: ${s.siteName}`:"",s.themeMode?`- Theme Mode: ${s.themeMode}`:""].join("\n"),"---","User Context:",`Brief: ${t}`,`Directives: ${JSON.stringify(M||{})}`,"---","Action: Generate JSON."].join("\n"),l="";for(let t=0;t<=2;t++){t>0&&(console.warn(`[Auto-Repair] Attempt ${t} for ${e}. Error: ${l}`),c+=`\n\nSYSTEM ALERT: Your previous JSON was invalid. \nErrors: ${l} \nPlease fix the JSON structure, remove unknown section types, and return ONLY the JSON object.`);try{const e=(await n(c)).response.text();if(!e)throw new Error("Empty response");const t=extractJson(e);t.template||(t.template=v),t.site||(t.site=s),t.sections||t.pages||(t.sections=[]),t.sections&&Array.isArray(t.sections)&&t.sections.forEach((e,t)=>{e.id||(e.id=`${e.type||"section"}-${t+1}`),!e.items&&["features","testimonials","stats"].includes(e.type)});const r=validatePageConfig(t);if(r.valid)return t;l=r.errors.join(", ")}catch(e){l=e.message||"Unknown parse error"}}throw new Error(`Failed to generate valid JSON after repairs. Errors: ${l}`)},s={};let o={siteName:"",tagline:"",primaryColor:"",themeMode:"dark"};try{const t=e.pages.find(e=>"home"===e.id),r=`${$||w}. ${(null==t?void 0:t.promptFocus)||"Main landing page."}`,a=await generatePageWithRepair("home",r,{},null==t?void 0:t.structure);o={siteName:(null==(l=a.site)?void 0:l.siteName)||"Generated Site",tagline:(null==(u=a.site)?void 0:u.tagline)||"",primaryColor:(null==(d=a.site)?void 0:d.primaryColor)||"",themeMode:(null==(m=a.site)?void 0:m.themeMode)||"dark"},s.home=a}catch(t){console.error("Home generation failed, falling back to mock",t),s.home=buildMockPageConfig({template:v,brief:$||w,stack:k,seed:A,wordpressBaseUrl:C,wordpressRestBase:F,structure:null==(f=e.pages.find(e=>"home"===e.id))?void 0:f.structure}),o={siteName:s.home.site.siteName||"",tagline:s.home.site.tagline||"",primaryColor:s.home.site.primaryColor||"",themeMode:s.home.site.themeMode||"dark"}}const a=e.pages.filter(e=>"home"!==e.id);if(console.log(`[Multi-Page] Selected Template: ${t}, Other Pages: ${a.length}`),a.length>0)for(const e of a){console.log(`[Multi-Page] Generating ${e.id}...`);const t=`${$||w}. Focus on ${e.id} page. ${e.promptFocus}`;try{const r=await generatePageWithRepair(e.id,t,o,e.structure);r.site||(r.site={}),r.site.siteName=o.siteName,r.site.tagline=o.tagline,o.primaryColor&&(r.site.primaryColor=o.primaryColor),r.site.themeMode=o.themeMode,s[e.id]=r,console.log(`[Multi-Page] Success: ${e.id}`)}catch(r){console.warn(`[Multi-Page] Failed ${e.id}, falling back to mock.`,r);const a=buildMockPageConfig({template:v,brief:t,stack:k,seed:A+hashString(e.id),structure:e.structure,themeMode:o.themeMode});a.site.siteName=o.siteName,a.site.primaryColor=o.primaryColor,s[e.id]=a}}j="Live OK (Gemini Multi-page)",O={template:v,templateId:t,site:(null==(h=s.home)?void 0:h.site)||{},backend:null==(g=s.home)?void 0:g.backend,pages:s,meta:null==(b=s.home)?void 0:b.meta}}catch(e){console.error("Gemini generation failed:",e),L="mock",j=`AI Error: ${e.message}. Fallback to mock.`,O=buildMockProject({template:v,brief:$||w,stack:k,seed:A,wordpressBaseUrl:C,wordpressRestBase:F})}}catch(e){console.error("Critical generation error:",e),L="mock",j=`Critical error: ${e.message}`,O=buildMockProject({template:v,brief:$||w,stack:k,seed:A,wordpressBaseUrl:C,wordpressRestBase:F})}const E={};if(O&&O.pages)for(const[e,t]of Object.entries(O.pages))E[e]=normalizePageConfig(t,{template:v,stack:k,seed:A,mode:L,wordpressBaseUrl:C,wordpressRestBase:F}),E[e].meta={...E[e].meta||{},mode:L,generatedAt:(new Date).toISOString(),seed:A,stack:k,note:j};return{config:{template:v,templateId:(null==O?void 0:O.templateId)||"unknown",site:(null==O?void 0:O.site)||{},backend:null==O?void 0:O.backend,pages:E,meta:{mode:L,generatedAt:(new Date).toISOString(),seed:A,stack:k,note:j,brief:w}}}}catch(e){return{config:null,error:e.message||"Unknown server error"}}});export{m as default};
//# sourceMappingURL=generate-page.post.mjs.map
