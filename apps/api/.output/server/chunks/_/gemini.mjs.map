{"version":3,"file":"gemini.mjs","sources":["../../../../../../node_modules/@google/generative-ai/dist/index.mjs","../../../../server/domain/generator/gemini.ts"],"names":["SchemaType","ExecutableCodeLanguage","Outcome","POSSIBLE_ROLES","HarmCategory","HarmBlockThreshold","HarmProbability","BlockReason","FinishReason","TaskType","FunctionCallingMode","DynamicRetrievalMode","GoogleGenerativeAIError","Error","constructor","message","super","GoogleGenerativeAIResponseError","response","this","GoogleGenerativeAIFetchError","status","statusText","errorDetails","GoogleGenerativeAIRequestInputError","GoogleGenerativeAIAbortError","Task","RequestUrl","model","task","apiKey","stream","requestOptions","toString","_a","_b","apiVersion","url","baseUrl","async","getHeaders","headers","Headers","append","clientHeaders","apiClient","push","join","getClientHeaders","customHeaders","e","JSON","stringify","headerName","headerValue","entries","makeModelRequest","body","fetchFn","fetch","fetchOptions","Object","assign","buildFetchOptions","method","constructModelRequest","err","name","stack","handleResponseError","ok","json","error","details","handleResponseNotOk","makeRequest","undefined","signal","timeout","controller","AbortController","setTimeout","abort","addEventListener","addHelpers","text","candidates","length","console","warn","hadBadFinishReason","formatBlockErrorMessage","_c","_d","textStrings","content","parts","part","executableCode","language","code","codeExecutionResult","output","getText","promptFeedback","functionCall","getFunctionCalls","functionCalls","badFinishReasons","RECITATION","SAFETY","LANGUAGE","candidate","finishReason","includes","firstCandidate","finishMessage","blockReason","blockReasonMessage","__await","v","__asyncGenerator","thisArg","_arguments","generator","Symbol","asyncIterator","TypeError","i","g","apply","q","verb","n","Promise","a","b","resume","r","value","resolve","then","fulfill","reject","settle","f","shift","SuppressedError","responseLineRE","processStream","responseStream","inputStream","reader","getReader","ReadableStream","start","currentText","pump","read","done","trim","close","parsedResponse","match","parse","enqueue","substring","catch","getResponseStream","pipeThrough","TextDecoderStream","fatal","stream1","stream2","tee","generateResponseSequence","getResponsePromise","allResponses","aggregateResponses","arguments","responses","lastResponse","aggregatedResponse","candidateIndex","index","citationMetadata","groundingMetadata","safetyRatings","role","newPart","keys","usageMetadata","generateContentStream","params","STREAM_GENERATE_CONTENT","generateContent","GENERATE_CONTENT","formatSystemInstruction","input","formatNewContent","request","newParts","partOrString","userContent","functionContent","hasUserContent","hasFunctionContent","assignRoleToPartsAndValidateSendMessageRequest","formatGenerateContentInput","formattedRequest","contents","systemInstruction","VALID_PART_FIELDS","VALID_PARTS_PER_ROLE","user","function","system","isValidResponse","SILENT_ERROR","ChatSession","_requestOptions","_history","_sendPromise","_apiKey","history","prevContent","currContent","Array","isArray","countFields","inlineData","functionResponse","fileData","key","validParts","validateChatHistory","getHistory","sendMessage","_e","_f","newContent","generateContentRequest","safetySettings","generationConfig","tools","toolConfig","cachedContent","chatSessionRequestOptions","finalResult","result","responseContent","blockErrorMessage","sendMessageStream","streamPromise","_ignored","streamResult","GenerativeModel","modelParams","formattedParams","generativeModelRequestOptions","startChat","startChatParams","countTokens","formattedGenerateContentRequest","containsGenerateContentRequest","formatCountTokensInput","singleRequestOptions","COUNT_TOKENS","embedContent","formatEmbedContentInput","EMBED_CONTENT","batchEmbedContents","batchEmbedContentRequest","requestsWithModel","requests","map","BATCH_EMBED_CONTENTS","GoogleGenerativeAI","getGenerativeModel","getGenerativeModelFromCachedContent","disallowedDuplicates","startsWith","replace","modelParamsFromCache","keyRing","currentIndex","genAIInstances","initKeys","rawKeys","useRuntimeConfig","geminiApiKey","process","env","GEMINI_API_KEY","split","k","filter","log","forEach","slice","getCurrentModel","instance","modelName","geminiModel","responseMimeType","rotateKey","prevIndex","generateContentStreamWithRetry","prompt","maxRetries","totalAttempts","Math","max","lastError","msg","isQuota","isServer","isInvalidKey","generateContentWithRetry"],"mappings":"","x_google_ignoreList":[0]}